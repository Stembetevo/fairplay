<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Generate Teams - FairPlay</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body>
    <nav class="navbar navbar-dark bg-dark">
        <div class="container-fluid">
            <a class="navbar-brand" href="{% url 'index' %}">âš½ FairPlay</a>
            <div>
                <a href="{% url 'playerslist' %}" class="btn btn-outline-light btn-sm me-2">All Players</a>
                <a href="{% url 'playeradd' %}" class="btn btn-outline-success btn-sm me-2">Add Player</a>
            </div>
        </div>
    </nav>

    <div class="container mt-4">
        <div class="row justify-content-center">
            <div class="col-md-8">
                <div class="card shadow">
                    <div class="card-header bg-primary text-white">
                        <h3 class="mb-0">Generate Teams</h3>
                    </div>
                    <div class="card-body">
                        {% if messages %}
                            {% for message in messages %}
                                <div class="alert alert-{{ message.tags }} alert-dismissible fade show" role="alert">
                                    {{ message }}
                                    <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
                                </div>
                            {% endfor %}
                        {% endif %}

                        {% if player_count < 2 %}
                            <div class="alert alert-warning">
                                <h5>Not enough players!</h5>
                                <p>You need at least 2 players to generate teams. Currently you have {{ player_count }} player(s).</p>
                                <a href="{% url 'playeradd' %}" class="btn btn-primary">Add Players</a>
                            </div>
                        {% else %}
                            <p class="mb-3">You have <strong>{{ player_count }}</strong> players ready. Enter the number of teams and their names below:</p>
                            
                            <form method="post" action="{% url 'generate_teams' %}" id="teamForm">
                                {% csrf_token %}
                                
                                <div class="mb-3">
                                    <label for="num_teams" class="form-label">Number of Teams (2-10)</label>
                                    <input type="number" 
                                           class="form-control" 
                                           id="num_teams" 
                                           name="num_teams" 
                                           min="2" 
                                           max="10" 
                                           value="2"
                                           required>
                                    <small class="form-text text-muted">Maximum {{ player_count }} teams (one player per team)</small>
                                </div>

                                <div id="teamNamesContainer" class="mb-3">
                                    <!-- Team name inputs will be generated here -->
                                </div>

                                <div class="d-grid gap-2">
                                    <button type="submit" class="btn btn-primary btn-lg">Generate Teams</button>
                                    <a href="{% url 'playerslist' %}" class="btn btn-outline-secondary">Back to Players</a>
                                </div>
                            </form>
                        {% endif %}
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        const maxPlayers = { player_count };
        const numTeamsInput = document.getElementById('num_teams');
        const teamNamesContainer = document.getElementById('teamNamesContainer');

        function generateTeamInputs() {
            const numTeams = parseInt(numTeamsInput.value) || 2;
            teamNamesContainer.innerHTML = '';

            for (let i = 1; i <= numTeams; i++) {
                const div = document.createElement('div');
                div.className = 'mb-2';
                div.innerHTML = `
                    <label for="team_${i}_name" class="form-label">Team ${i} Name</label>
                    <input type="text" 
                           class="form-control" 
                           id="team_${i}_name" 
                           name="team_${i}_name" 
                           placeholder="Enter name for Team ${i}" 
                           value="Team ${i}"
                           required>
                `;
                teamNamesContainer.appendChild(div);
            }
        }

        numTeamsInput.addEventListener('change', function() {
            const value = parseInt(this.value);
            if (value > maxPlayers) {
                this.value = maxPlayers;
                alert(`Maximum ${maxPlayers} teams (you have ${maxPlayers} players)`);
            }
            generateTeamInputs();
        });

        // Initialize with 2 teams
        generateTeamInputs();
    </script>
</body>
</html>
